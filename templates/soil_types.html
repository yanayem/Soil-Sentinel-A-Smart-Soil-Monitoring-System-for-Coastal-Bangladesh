{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soil Types in Bangladesh</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: "class" }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-500 min-h-screen">

  {% include "nav.html" %}

  <div class="container mx-auto py-12 px-4">
    <h1 class="text-4xl font-bold mb-6 text-green-600 dark:text-green-400 text-center">ðŸŒ± Soil Types in Bangladesh</h1>

    <!-- Filters -->
    <div class="mb-4 flex flex-wrap gap-3 justify-between relative">
      <div class="relative w-full md:w-1/4">
        <input type="text" id="searchInput" placeholder="Search Soil Type..." class="px-3 py-2 rounded-lg w-full bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">
        <ul id="suggestions" class="absolute top-full left-0 w-full bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 border rounded-lg max-h-40 overflow-y-auto hidden z-20"></ul>
      </div>

      <input type="number" id="phInput" placeholder="pH" step="0.1" class="px-3 py-2 rounded-lg w-20 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">
      <input type="number" id="moistureInput" placeholder="Moisture" step="0.1" class="px-3 py-2 rounded-lg w-20 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">
      <input type="number" id="tempInput" placeholder="Temp" step="0.1" class="px-3 py-2 rounded-lg w-20 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">
      <input type="number" id="humidityInput" placeholder="Humidity" step="0.1" class="px-3 py-2 rounded-lg w-20 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">
      <input type="number" id="salinityInput" placeholder="Salinity" step="0.1" class="px-3 py-2 rounded-lg w-20 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 shadow">

      <button id="resetBtn" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg">Reset</button>
    </div>

    <!-- Soil Types Table -->
    <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg max-h-[600px] overflow-y-auto">
      <table id="soilTable" class="w-full table-auto text-sm text-gray-800 dark:text-gray-100 border-collapse">
        <thead class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 sticky top-0 z-10">
          <tr>
            <th class="px-3 py-2">#</th>
            <th class="px-3 py-2">Name</th>
            <th class="px-3 py-2 text-center">pH Min</th>
            <th class="px-3 py-2 text-center">pH Max</th>
            <th class="px-3 py-2 text-center">Moisture Min</th>
            <th class="px-3 py-2 text-center">Moisture Max</th>
            <th class="px-3 py-2 text-center">Temp Min</th>
            <th class="px-3 py-2 text-center">Temp Max</th>
            <th class="px-3 py-2 text-center">Humidity Min</th>
            <th class="px-3 py-2 text-center">Humidity Max</th>
            <th class="px-3 py-2 text-center">Salinity Min</th>
            <th class="px-3 py-2 text-center">Salinity Max</th>
            <th class="px-3 py-2">Crops</th>
          </tr>
        </thead>
        <tbody>
          {% for soil in soil_types %}
          <tr class="border-b border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <td class="px-2 py-1 text-center">{{ forloop.counter }}</td>
            <td class="px-2 py-1">{{ soil.name }}</td>
            <td class="px-2 py-1 text-center">{{ soil.ph_min }}</td>
            <td class="px-2 py-1 text-center">{{ soil.ph_max }}</td>
            <td class="px-2 py-1 text-center">{{ soil.moisture_min }}</td>
            <td class="px-2 py-1 text-center">{{ soil.moisture_max }}</td>
            <td class="px-2 py-1 text-center">{{ soil.temp_min }}</td>
            <td class="px-2 py-1 text-center">{{ soil.temp_max }}</td>
            <td class="px-2 py-1 text-center">{{ soil.humidity_min }}</td>
            <td class="px-2 py-1 text-center">{{ soil.humidity_max }}</td>
            <td class="px-2 py-1 text-center">{{ soil.salinity_min }}</td>
            <td class="px-2 py-1 text-center">{{ soil.salinity_max }}</td>
            <td class="px-2 py-1">{{ soil.crops }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
  // ---------------- Auto Filter ----------------
  const phInput = document.getElementById("phInput");
  const moistureInput = document.getElementById("moistureInput");
  const tempInput = document.getElementById("tempInput");
  const humidityInput = document.getElementById("humidityInput");
  const salinityInput = document.getElementById("salinityInput");
  const searchInput = document.getElementById("searchInput");
  const suggestions = document.getElementById("suggestions");

  // Collect soil names for suggestions
  const soilNames = Array.from(document.querySelectorAll("#soilTable tbody tr td:nth-child(2)"))
                         .map(td => td.innerText);

  function updateSuggestions() {
    const val = searchInput.value.toLowerCase();
    suggestions.innerHTML = '';
    if (!val) { suggestions.style.display = 'none'; return; }

    const filtered = soilNames.filter(name => name.toLowerCase().includes(val));
    filtered.forEach(name => {
      const li = document.createElement('li');
      li.className = "px-3 py-1 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-pointer";
      li.innerText = name;
      li.addEventListener('click', () => {
        searchInput.value = name;
        suggestions.style.display = 'none';
        filterTable();
      });
      suggestions.appendChild(li);
    });
    suggestions.style.display = filtered.length ? 'block' : 'none';
  }

  function filterTable() {
    const searchVal = searchInput.value.toLowerCase();
    const phVal = parseFloat(phInput.value);
    const moistureVal = parseFloat(moistureInput.value);
    const tempVal = parseFloat(tempInput.value);
    const humidityVal = parseFloat(humidityInput.value);
    const salinityVal = parseFloat(salinityInput.value);

    document.querySelectorAll("#soilTable tbody tr").forEach(row => {
      const name = row.cells[1].innerText.toLowerCase();
      const phMin = parseFloat(row.cells[2].innerText);
      const phMax = parseFloat(row.cells[3].innerText);
      const moistureMin = parseFloat(row.cells[4].innerText);
      const moistureMax = parseFloat(row.cells[5].innerText);
      const tempMin = parseFloat(row.cells[6].innerText);
      const tempMax = parseFloat(row.cells[7].innerText);
      const humidityMin = parseFloat(row.cells[8].innerText);
      const humidityMax = parseFloat(row.cells[9].innerText);
      const salinityMin = parseFloat(row.cells[10].innerText);
      const salinityMax = parseFloat(row.cells[11].innerText);

      const matches =
        (!searchVal || name.includes(searchVal)) &&
        (isNaN(phVal) || (phVal >= phMin && phVal <= phMax)) &&
        (isNaN(moistureVal) || (moistureVal >= moistureMin && moistureVal <= moistureMax)) &&
        (isNaN(tempVal) || (tempVal >= tempMin && tempVal <= tempMax)) &&
        (isNaN(humidityVal) || (humidityVal >= humidityMin && humidityVal <= humidityMax)) &&
        (isNaN(salinityVal) || (salinityVal >= salinityMin && salinityVal <= salinityMax));

      row.style.display = matches ? "" : "none";
    });
  }

  // Event listeners
  searchInput.addEventListener("input", () => { updateSuggestions(); filterTable(); });
  phInput.addEventListener("input", filterTable);
  moistureInput.addEventListener("input", filterTable);
  tempInput.addEventListener("input", filterTable);
  humidityInput.addEventListener("input", filterTable);
  salinityInput.addEventListener("input", filterTable);

  // Reset
  document.getElementById("resetBtn").addEventListener("click", () => {
    searchInput.value = "";
    phInput.value = "";
    moistureInput.value = "";
    tempInput.value = "";
    humidityInput.value = "";
    salinityInput.value = "";
    suggestions.style.display = 'none';
    filterTable();
  });
  </script>
</body>
</html>
