{% load static %}
<!DOCTYPE html>
<html lang="en" class="transition-colors duration-500">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soil Monitor</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">

<!-- ================= TOP BAR ================= -->
<header class="fixed top-0 left-0 w-full bg-white dark:bg-[#27374d] shadow-xl z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center h-16">

      <!-- Logo -->
      <div class="flex items-center gap-2">
        <button id="mobileMenuBtn" class="md:hidden p-2">
          <i class="fas fa-bars text-lg"></i>
        </button>

        <img src="{% static 'media/logo.png' %}" class="h-12 w-12 rounded-full" alt="Logo">
        <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">
          Soil Monitor
        </span>
      </div>

      <!-- Right -->
      <div class="flex items-center gap-4">

        <!-- Theme Toggle -->
        <button id="themeToggle" class="p-2">
          <i id="themeIcon" class="fas fa-sun text-yellow-400 text-lg"></i>
        </button>

        <!-- User -->
        <div class="flex items-center gap-2 bg-white dark:bg-gray-700 px-3 py-1 rounded-full shadow">
          <img
            src="{% if global_profile.profile_pic and global_profile.profile_pic.name %}
              {{ global_profile.profile_pic.url }}
            {% else %}
              https://www.w3schools.com/howto/img_avatar.png
            {% endif %}"
            class="h-10 w-10 rounded-full border-2 border-blue-500 object-cover"
            alt="Profile">

          <span class="font-medium">
            {{ global_profile.user.first_name }} {{ global_profile.user.last_name }}
          </span>
        </div>

      </div>
    </div>
  </div>
</header>

<!-- ================= SIDEBAR ================= -->
<aside id="sidebarMenu"
  class="fixed top-16 left-0 w-64 h-full bg-gray-100 dark:bg-[#27374d]
         shadow-2xl z-40 transform -translate-x-full md:translate-x-0
         transition-transform duration-300 overflow-y-auto">

  <ul class="mt-4 space-y-1 px-2">

    <!-- COMMON SIDEBAR STYLE -->
    {% comment %} 
    Light mode: bg-blue-200 / hover bg-blue-200
    Dark mode: bg-[#3a506b]
    {% endcomment %}

    <!-- Dashboard -->
    <li>
      <a href="{% url 'soildata:dashboard' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
        <i class="fa fa-tachometer-alt text-blue-500"></i> Dashboard
      </a>
    </li>

    <!-- Soil Moisture -->
    <li>
      <a href="{% url 'soildata:soil_moisture' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'soil_moisture' %}active{% endif %}">
        <i class="fa fa-leaf text-green-500"></i> Soil Moisture
      </a>
    </li>

    <!-- Alerts -->
    <li>
      <a href="{% url 'soildata:alerts' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'alerts' %}active{% endif %}">
        <i class="fa fa-bell text-yellow-400"></i> Alerts
      </a>
    </li>

    <!-- Soil Analyzer -->
    <li>
      <a href="{% url 'soilvision:soil_upload' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'soil_upload' %}active{% endif %}">
        <i class="fa fa-seedling text-green-500"></i> Soil Analyzer
      </a>
    </li>

    <!-- Crop Advisor -->
    <li>
      <a href="{% url 'soildata:crop_advisor' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'crop_advisor' %}active{% endif %}">
        <i class="fa fa-lightbulb text-green-400"></i> Crop Advisor
      </a>
    </li>

    <!-- ChatBot -->
    <li>
      <a href="{% url 'chat_new' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'chat_new' %}active{% endif %}">
        <i class="fa fa-comments text-pink-500"></i> ChatBot
      </a>
    </li>

    <!-- Settings -->
    <li>
      <a href="{% url 'account:settingpage' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'settingpage' %}active{% endif %}">
        <i class="fa fa-cog text-gray-500"></i> Settings
      </a>
    </li>

    <!-- Profile -->
    <li>
      <a href="{% url 'account:profilepage' %}"
         class="sidebar-link {% if request.resolver_match.url_name == 'profilepage' %}active{% endif %}">
        <i class="fa fa-user text-gray-500"></i> Profile
      </a>
    </li>

    <!-- Logout -->
    <li>
      <a href="{% url 'account:logout' %}"
         class="flex items-center gap-3 px-5 py-3 rounded-lg
                bg-red-500 hover:bg-red-600 text-white transition-all">
        <i class="fa fa-sign-out-alt"></i> Logout
      </a>
    </li>

  </ul>
</aside>

<!-- ================= SIDEBAR STYLES ================= -->
<style>
  .sidebar-link{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 20px;
    border-radius:10px;
    transition:all .2s ease;
  }
  .sidebar-link:hover{
    background:#bfdbfe; /* blue-200 */
  }
  .dark .sidebar-link:hover{
    background:#3a506b;
  }
  .sidebar-link.active{
    background:#bfdbfe;
    font-weight:600;
  }
  .dark .sidebar-link.active{
    background:#3a506b;
  }
</style>

<!-- ================= SCRIPTS ================= -->
<script>
  const html = document.documentElement;
  const themeToggle = document.getElementById("themeToggle");
  const themeIcon = document.getElementById("themeIcon");
  const sidebar = document.getElementById("sidebarMenu");
  const mobileBtn = document.getElementById("mobileMenuBtn");

  if(localStorage.theme === "dark") html.classList.add("dark");
  updateIcon();

  function updateIcon(){
    themeIcon.className = html.classList.contains("dark")
      ? "fas fa-moon text-yellow-300"
      : "fas fa-sun text-yellow-400";
  }

  themeToggle.onclick = () => {
    html.classList.toggle("dark");
    localStorage.theme = html.classList.contains("dark") ? "dark" : "light";
    updateIcon();
  };

  mobileBtn.onclick = () => sidebar.classList.toggle("-translate-x-full");
</script>

</body>
</html>
